import mongoose from "mongoose";
import { NextResponse } from "next/server";
import { parse, format } from "date-fns"
import { enGB } from "date-fns/locale";

export function stringToObjectId(id: string): mongoose.Types.ObjectId | null {
    if (mongoose.Types.ObjectId.isValid(id)) {
        return new mongoose.Types.ObjectId(id);
    } else {
        return null
    }
}

// _________________________________________________________________________________________________________________________________________________________________________
// _________________________________________________________________________________________________________________________________________________________________________
// _________________________________________________________________________________________________________________________________________________________________________

export function createErrorResponse(
    message: string,
    statusCode: number
): NextResponse {
    const errorResponse = {
        status: statusCode >= 500 ? "error" : "fail",
        message,
    };

    return new NextResponse(JSON.stringify(errorResponse), {
        status: statusCode,
        headers: { "Contetn-Type": "application/json" },
    });
}

// _________________________________________________________________________________________________________________________________________________________________________
// _________________________________________________________________________________________________________________________________________________________________________
// _________________________________________________________________________________________________________________________________________________________________________

export function stringToDate(dateString: string) {
    const date: Date = parse(dateString, "dd/MM/yyyy", new Date(), { locale: enGB })

    return (date)
}

// _________________________________________________________________________________________________________________________________________________________________________
// _________________________________________________________________________________________________________________________________________________________________________
// _________________________________________________________________________________________________________________________________________________________________________

export function dateToString(date: Date) {
    const dateString = format(date, "dd/MM/yyyy")

    return dateString
}

// _________________________________________________________________________________________________________________________________________________________________________
// _________________________________________________________________________________________________________________________________________________________________________
// _________________________________________________________________________________________________________________________________________________________________________

export function getMonthsBetweenDates(startDate: Date, endDate: Date) {
    const months: Date[] = [];

    let currentDate = new Date(startDate.getFullYear(), startDate.getMonth(), startDate.getDate());
    while (currentDate <= endDate) {
        months.push(new Date(currentDate));
        currentDate.setMonth(currentDate.getMonth() + 1);
    }
    return months;
}

// _________________________________________________________________________________________________________________________________________________________________________
// _________________________________________________________________________________________________________________________________________________________________________
// _________________________________________________________________________________________________________________________________________________________________________

export function getLastTwelveMonths() {
    const endDate = new Date;
    const startDate = new Date(endDate.getFullYear() - 1, endDate.getMonth(), 1);
    const monthsBetweenDates = getMonthsBetweenDates(startDate, endDate);
    return monthsBetweenDates;
}