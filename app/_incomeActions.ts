"use server";

import { createIncome, deleteIncome, getIncome, getIncomesBetweenDates, updateIncome } from "./lib/income-db";
import { revalidatePath } from "next/cache";
import { stringToDate } from "./lib/utils";

// _________________________________________________________________________________________________________________________________________________________________________
// _________________________________________________________________________________________________________________________________________________________________________
// _________________________________________________________________________________________________________________________________________________________________________

export async function getIncomeAction({
    id
}: {
    id: string;
}) {
    const { income } = await getIncome(id);

    if (income) {
        income._id = income?._id.toString()
    }

    return {
        income: income
    };
}

// _________________________________________________________________________________________________________________________________________________________________________
// _________________________________________________________________________________________________________________________________________________________________________
// _________________________________________________________________________________________________________________________________________________________________________

export async function getIncomesBetweenDatesAction({
    startDate,
    endDate,
    userId,
}: {
    startDate: Date;
    endDate: Date;
    userId: string;
}) {
    const { incomes, results } = await getIncomesBetweenDates({ userId }, startDate, endDate)

    return {
        incomes: incomes,
        results
    };
}

// _________________________________________________________________________________________________________________________________________________________________________
// _________________________________________________________________________________________________________________________________________________________________________
// _________________________________________________________________________________________________________________________________________________________________________

export async function createIncomeAction({
    incomeDate,
    company,
    amount,
    incomeCategory,
    notes,
    path,
    userId,
}: {
    incomeDate: string;
    company: string;
    amount: number;
    incomeCategory: string;
    notes: string;
    path: string;
    userId: string;
}) {
    const parsedIncomeDate = stringToDate(incomeDate)
    await createIncome(parsedIncomeDate, company, amount, incomeCategory, notes, userId);
    revalidatePath(path);
}

// _________________________________________________________________________________________________________________________________________________________________________
// _________________________________________________________________________________________________________________________________________________________________________
// _________________________________________________________________________________________________________________________________________________________________________

export async function updateIncomeAction(
    id: string,
    update: { incomeDate?: Date; company?: string; amount?: number; incomeCategory?: string; notes?: string; },
    path: string
) {
    await updateIncome(id, update);
    revalidatePath(path);
}

// _________________________________________________________________________________________________________________________________________________________________________
// _________________________________________________________________________________________________________________________________________________________________________
// _________________________________________________________________________________________________________________________________________________________________________

export async function deleteIncomeAction({
    id,
    path,
}: {
    id: string;
    path: string;
}) {
    await deleteIncome(id);
    revalidatePath(path);
}

// _________________________________________________________________________________________________________________________________________________________________________
// _________________________________________________________________________________________________________________________________________________________________________
// _________________________________________________________________________________________________________________________________________________________________________
